<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenShows | Ultimate Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #ff0000; --bg: #080808; --card-bg: #151515;
            --text: #ffffff; --glass: rgba(255, 255, 255, 0.08);
        }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }
        
        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 5%; background: rgba(8, 8, 8, 0.9);
            backdrop-filter: blur(20px); position: fixed; width: 90%; z-index: 1000;
        }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--primary); }
        .logo span { color: white; }

        .container { padding: 100px 5% 50px; }
        .row-title { font-size: 1.5rem; margin: 30px 0 15px; font-weight: 700; border-left: 4px solid var(--primary); padding-left: 15px; }

        .movie-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 20px;
        }

        .card {
            background: var(--card-bg); border-radius: 10px; overflow: hidden;
            transition: 0.3s ease; cursor: pointer; position: relative;
        }
        .card:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .card img { width: 100%; aspect-ratio: 2/3; object-fit: cover; }
        .card-btn { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); border: none; color: white; padding: 5px; border-radius: 50%; }

        /* Modal & Player */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 2000; overflow-y: auto; }
        .modal-content { width: 95%; max-width: 1200px; margin: 50px auto; }
        .player-box { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }

        .controls { display: flex; flex-wrap: wrap; gap: 10px; margin: 20px 0; align-items: center; }
        .btn { background: var(--glass); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .btn.active { background: var(--primary); }
        .ep-input { background: #222; border: 1px solid #444; color: white; padding: 10px; border-radius: 8px; width: 60px; }

        .details { display: grid; grid-template-columns: 3fr 1fr; gap: 30px; margin-top: 30px; }
        @media (max-width: 768px) { .details { grid-template-columns: 1fr; } .navbar { width: 100%; padding: 10px; } }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="logo">ZEN<span>SHOWS</span></div>
        <div class="nav-links">
            <button class="btn" onclick="showWatchlist()"><i class="fas fa-bookmark"></i> Watchlist</button>
        </div>
    </nav>

    <div class="container">
        <div id="watchlist-section" style="display:none;">
            <h2 class="row-title">My Watchlist</h2>
            <div id="watchlist-grid" class="movie-grid"></div>
        </div>

        <h2 class="row-title">Trending Content</h2>
        <div id="main-grid" class="movie-grid"></div>
    </div>

    <div id="playerModal" class="modal">
        <div class="modal-content">
            <div class="player-box" id="player-box"></div>
            
            <div class="controls">
                <button class="btn srv active" onclick="setServer('vidsrc', this)">VidSrc</button>
                <button class="btn srv" onclick="setServer('bidsrc', this)">BidSrc Pro</button>
                <button class="btn srv" onclick="setServer('cinemaos', this)">CinemaOS</button>
                
                <div id="tv-controls" style="display:none;">
                    S: <input type="number" id="season" class="ep-input" value="1">
                    E: <input type="number" id="episode" class="ep-input" value="1">
                    <button class="btn" onclick="updateTV()">Load</button>
                </div>

                <button class="btn" id="save-btn" onclick="addToFirebase()"><i class="fas fa-plus"></i> Watchlist</button>
                <button class="btn" onclick="share()"><i class="fab fa-whatsapp"></i></button>
                <button class="btn" style="background:#444" onclick="closeModal()">Close</button>
            </div>

            <div class="details">
                <div>
                    <h1 id="m-title"></h1>
                    <p id="m-desc" style="color:#ccc; line-height:1.6;"></p>
                </div>
                <div id="m-similar"></div>
            </div>
        </div>
    </div>

    <script>
        // --- FIREBASE CONFIGURATION ---
        // Replace with your actual Firebase config from Firebase Console
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "zenshows.firebaseapp.com",
            projectId: "zenshows",
            storageBucket: "zenshows.appspot.com",
            messagingSenderId: "12345",
            appId: "1:12345:web:12345"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const TMDB_KEY = '60defb38119575da952b28d206871c1b';
        let currentID, currentType, currentData;

        // Load Initial Data
        window.onload = () => fetchTrending();

        async function fetchTrending() {
            const res = await fetch(`https://api.themoviedb.org/3/trending/all/week?api_key=${TMDB_KEY}`);
            const data = await res.json();
            renderGrid(data.results, 'main-grid');
        }

        function renderGrid(data, target) {
            const grid = document.getElementById(target);
            grid.innerHTML = data.map(m => `
                <div class="card" onclick="openPlayer(${m.id}, '${m.media_type || 'movie'}')">
                    <img src="https://image.tmdb.org/t/p/w500${m.poster_path}" alt="">
                </div>
            `).join('');
        }

        async function openPlayer(id, type) {
            currentID = id; currentType = type;
            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${TMDB_KEY}`);
            currentData = await res.json();

            document.getElementById('playerModal').style.display = 'block';
            document.getElementById('m-title').innerText = currentData.title || currentData.name;
            document.getElementById('m-desc').innerText = currentData.overview;
            
            document.getElementById('tv-controls').style.display = type === 'tv' ? 'block' : 'none';
            setServer('vidsrc', document.querySelector('.srv'));
        }

        function setServer(src, btn) {
            document.querySelectorAll('.srv').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const s = document.getElementById('season').value;
            const e = document.getElementById('episode').value;
            let url = '';

            if (src === 'vidsrc') {
                url = currentType === 'movie' ? `https://vidsrc.me/embed/movie?tmdb=${currentID}` : `https://vidsrc.me/embed/tv?tmdb=${currentID}&sea=${s}&epi=${e}`;
            } else if (src === 'bidsrc') {
                url = `https://bidsrc.pro/embed/${currentType}/${currentID}${currentType === 'tv' ? `/${s}/${e}` : ''}`;
            } else if (src === 'cinemaos') {
                url = currentType === 'movie' ? `https://cinemaos.tech/player/${currentID}` : `https://cinemaos.tech/player/${currentID}/${s}/${e}`;
            }

            document.getElementById('player-box').innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
        }

        function updateTV() { setServer('vidsrc', document.querySelector('.srv.active')); }

        // --- FIREBASE WATCHLIST LOGIC ---
        async function addToFirebase() {
            const movieObj = {
                id: currentID,
                type: currentType,
                title: currentData.title || currentData.name,
                poster: currentData.poster_path,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            await db.collection("watchlist").doc(currentID.toString()).set(movieObj);
            alert("Added to Watchlist!");
        }

        async function showWatchlist() {
            const section = document.getElementById('watchlist-section');
            section.style.display = 'block';
            const snapshot = await db.collection("watchlist").orderBy("timestamp", "desc").get();
            const data = snapshot.docs.map(doc => doc.data());
            
            const grid = document.getElementById('watchlist-grid');
            grid.innerHTML = data.map(m => `
                <div class="card" onclick="openPlayer(${m.id}, '${m.type}')">
                    <img src="https://image.tmdb.org/t/p/w500${m.poster}">
                    <button class="card-btn" onclick="removeFromWatchlist(event, '${m.id}')">&times;</button>
                </div>
            `).join('');
            window.scrollTo(0, 0);
        }

        async function removeFromWatchlist(e, id) {
            e.stopPropagation();
            await db.collection("watchlist").doc(id).delete();
            showWatchlist();
        }

        function closeModal() {
            document.getElementById('playerModal').style.display = 'none';
            document.getElementById('player-box').innerHTML = '';
        }

        function share() {
            const url = window.location.href;
            window.open(`https://api.whatsapp.com/send?text=Watching ${currentData.title || currentData.name} on ZenShows! ${url}`);
        }
    </script>
</body>
</html>

