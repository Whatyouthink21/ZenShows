<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenShows — Absolute Streaming</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100;400;700;900&display=swap');
        
        :root { --accent: #ff0032; --bg: #030303; --surface: #0f0f0f; }
        body { font-family: 'Outfit', sans-serif; background-color: var(--bg); color: white; overflow-x: hidden; }

        /* Smooth Section Transitions */
        .reveal { opacity: 0; transform: translateY(40px); transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1); }
        .reveal.active { opacity: 1; transform: translateY(0); }

        /* High-End Card Styling */
        .movie-card { transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); perspective: 1000px; }
        .movie-card:hover { transform: scale(1.05) translateY(-10px); }
        .movie-card img { box-shadow: 0 0 0 rgba(255, 0, 50, 0); transition: box-shadow 0.4s; }
        .movie-card:hover img { box-shadow: 0 10px 30px rgba(255, 0, 50, 0.3); }

        /* The "Clean" Player Shield */
        .player-wrapper { position: relative; width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
        /* This prevents most invisible popup overlays in the iframe */
        .ad-shield { position: absolute; inset: 0; pointer-events: none; border: 4px solid transparent; transition: border 0.3s; z-index: 10; }
        .player-wrapper:hover .ad-shield { border-color: rgba(255, 0, 50, 0.2); }

        .glass-header { background: rgba(3, 3, 3, 0.7); backdrop-filter: blur(25px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .btn-premium { background: linear-gradient(45deg, var(--accent), #ff4d00); transition: all 0.3s; border: none; }
        .btn-premium:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(255, 0, 50, 0.4); }

        .cast-pill { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; }
        .cast-pill:hover { background: var(--accent); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
    </style>
</head>
<body>

    <div id="sidebar" class="fixed right-0 top-0 h-full w-80 bg-[#0a0a0a] z-[150] translate-x-full transition-transform duration-500 p-6 border-l border-white/10">
        <div class="flex justify-between items-center mb-8">
            <h3 class="text-xl font-bold">Your Library</h3>
            <button onclick="toggleSidebar()" class="text-2xl">&times;</button>
        </div>
        <div id="sidebarContent" class="space-y-4"></div>
    </div>

    <nav class="fixed top-0 w-full z-[100] glass-header px-6 md:px-12 py-4 flex justify-between items-center">
        <div class="flex items-center gap-12">
            <h1 class="text-3xl font-black tracking-tighter cursor-pointer" onclick="location.reload()">
                <span class="text-red-600">ZEN</span>SHOWS
            </h1>
            <div class="hidden lg:flex gap-8 font-bold text-xs uppercase tracking-[0.2em] text-gray-400">
                <a href="#" onclick="fetchCategory('movie')" class="hover:text-red-500 transition">Movies</a>
                <a href="#" onclick="fetchCategory('tv')" class="hover:text-red-500 transition">Series</a>
                <a href="#" onclick="toggleSidebar()" class="hover:text-red-500 transition">My List</a>
            </div>
        </div>
        <div class="flex items-center gap-6">
            <div class="relative group hidden md:block">
                <input type="text" id="searchInput" placeholder="Search Cinematic Universe..." 
                    class="bg-white/5 border border-white/10 px-6 py-2 rounded-full text-sm focus:w-80 transition-all outline-none focus:border-red-600">
                <i class="fa fa-search absolute right-5 top-3 text-gray-500"></i>
            </div>
            <button onclick="toggleSidebar()" class="w-10 h-10 rounded-full border border-white/10 flex items-center justify-center hover:bg-white/5 transition">
                <i class="fa fa-bookmark"></i>
            </button>
        </div>
    </nav>

    <section id="hero" class="relative h-screen w-full flex items-center px-6 md:px-12">
        <div id="heroBg" class="absolute inset-0 z-0 bg-cover bg-center transition-all duration-1000 brightness-50"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-[#030303] via-transparent to-transparent z-10"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-[#030303] via-[#030303]/40 to-transparent z-10"></div>
        
        <div class="relative z-20 max-w-4xl reveal active">
            <div class="flex items-center gap-3 mb-6">
                <span class="px-3 py-1 bg-red-600 text-[10px] font-black rounded">PREMIUM</span>
                <span id="heroYear" class="text-gray-400 font-bold"></span>
                <span id="heroRating" class="text-yellow-500 font-bold"><i class="fa fa-star"></i> </span>
            </div>
            <h2 id="heroTitle" class="text-6xl md:text-8xl font-black mb-6 leading-none"></h2>
            <p id="heroDesc" class="text-gray-300 text-lg md:text-xl mb-10 line-clamp-3 font-light leading-relaxed max-w-2xl"></p>
            <div class="flex gap-4">
                <button onclick="playMainHero()" class="btn-premium px-12 py-4 rounded-full font-black text-sm uppercase tracking-widest flex items-center gap-3">
                    <i class="fa fa-play"></i> Watch Now
                </button>
                <button onclick="saveToWatchlistFromHero()" class="px-10 py-4 rounded-full bg-white/5 border border-white/10 font-black text-sm uppercase hover:bg-white/10 transition">
                    + Watchlist
                </button>
            </div>
        </div>
    </section>

    <main class="relative z-20 -mt-20 px-6 md:px-12 space-y-20 pb-20">
        <section>
            <div class="flex justify-between items-end mb-10">
                <h3 id="sectionTitle" class="text-3xl font-black italic uppercase tracking-tighter">Trending Discovery</h3>
                <div class="h-px flex-grow mx-8 bg-white/10 hidden md:block"></div>
            </div>
            <div id="grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-x-6 gap-y-12"></div>
        </section>
    </main>

    <div id="playerModal" class="fixed inset-0 z-[200] bg-[#030303] hidden flex-col overflow-y-auto custom-scrollbar">
        <div class="sticky top-0 z-50 p-6 flex justify-between items-center glass-header">
            <div>
                <h4 id="mTitle" class="text-2xl font-black uppercase italic"></h4>
                <p id="mMeta" class="text-xs text-red-500 font-bold tracking-widest"></p>
            </div>
            <button onclick="closePlayer()" class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center hover:bg-red-600 transition">
                <i class="fa fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-6 md:p-12 max-w-7xl mx-auto w-full space-y-12">
            <div class="player-wrapper shadow-2xl shadow-red-600/10">
                <div class="ad-shield"></div>
                <iframe id="videoFrame" src="" allowfullscreen allow="autoplay"></iframe>
            </div>

            <div class="bg-white/5 p-6 rounded-3xl border border-white/10">
                <h5 class="text-[10px] font-black text-gray-500 uppercase tracking-[0.3em] mb-4 text-center">Cloud Streaming Servers (No-Ad Priority)</h5>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-3" id="sourceBtns">
                    </div>
            </div>

            <div class="grid md:grid-cols-3 gap-12">
                <div class="md:col-span-2 space-y-6">
                    <h5 class="text-xl font-bold border-b border-red-600 inline-block pb-1">Synopsis</h5>
                    <p id="mOverview" class="text-gray-400 leading-relaxed text-lg font-light"></p>
                    
                    <div id="tvSelectors" class="hidden grid grid-cols-2 gap-4">
                        <select id="sSelect" onchange="loadEpisodes()" class="bg-zinc-900 border border-white/10 p-4 rounded-xl outline-none focus:border-red-600"></select>
                        <select id="eSelect" onchange="updatePlayerSource()" class="bg-zinc-900 border border-white/10 p-4 rounded-xl outline-none focus:border-red-600"></select>
                    </div>

                    <div class="space-y-4">
                        <h5 class="text-sm font-bold uppercase tracking-widest text-gray-500">Starring</h5>
                        <div id="castList" class="flex flex-wrap gap-3"></div>
                    </div>
                </div>

                <div class="bg-white/5 p-8 rounded-3xl border border-white/10 h-fit space-y-6">
                    <div>
                        <p class="text-[10px] font-bold text-red-600 uppercase">Director</p>
                        <p id="mDir" class="text-lg font-bold">N/A</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-red-600 uppercase">Original Release</p>
                        <p id="mDate" class="text-lg font-bold">N/A</p>
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-red-600 uppercase">Average Rating</p>
                        <p id="mRate" class="text-2xl font-black text-yellow-500"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="p-20 text-center border-t border-white/5">
        <p class="text-gray-600 text-xs font-bold uppercase tracking-[0.5em] mb-4">ZenShows Entertainment</p>
        <div class="flex justify-center items-center gap-4 opacity-30 grayscale grayscale hover:grayscale-0 transition duration-500 cursor-help" title="Powered by TMDB">
            <img src="https://www.themoviedb.org/assets/2/v4/logos/v2/blue_square_1-5bdc75aae11ef22012d627d3728a39652114840ad0f29942e685f479132e305f.svg" class="h-6">
            <span class="text-[10px] font-bold">Data provided by TheMovieDB</span>
        </div>
    </footer>

    <script>
        const API_KEY = 'a45420333457411e78d5ad35d6c51a2d';
        const TMDB = 'https://api.themoviedb.org/3';
        const IMG = 'https://image.tmdb.org/t/p/original';
        const POSTER = 'https://image.tmdb.org/t/p/w500';

        let currentData = { id: '', type: '', title: '' };
        let hContent = null;

        // Initialization
        window.onload = () => {
            fetchTrending();
            setupSearch();
            window.addEventListener('scroll', revealSections);
        };

        function revealSections() {
            const reveals = document.querySelectorAll('.reveal');
            reveals.forEach(r => {
                const top = r.getBoundingClientRect().top;
                if (top < window.innerHeight - 100) r.classList.add('active');
            });
        }

        async function fetchTrending() {
            const res = await fetch(`${TMDB}/trending/all/day?api_key=${API_KEY}`);
            const data = await res.json();
            hContent = data.results[0];
            updateHero(hContent);
            renderGrid(data.results);
        }

        async function fetchCategory(type) {
            const res = await fetch(`${TMDB}/${type}/popular?api_key=${API_KEY}`);
            const data = await res.json();
            renderGrid(data.results.map(i => ({...i, media_type: type})));
            document.getElementById('sectionTitle').innerText = `${type === 'movie' ? 'Blockbuster' : 'Epic'} Series`;
            window.scrollTo({top: 700, behavior: 'smooth'});
        }

        function updateHero(item) {
            document.getElementById('heroBg').style.backgroundImage = `url(${IMG + item.backdrop_path})`;
            document.getElementById('heroTitle').innerText = item.title || item.name;
            document.getElementById('heroDesc').innerText = item.overview;
            document.getElementById('heroRating').innerHTML += item.vote_average.toFixed(1);
            document.getElementById('heroYear').innerText = (item.release_date || item.first_air_date || '').split('-')[0];
        }

        function renderGrid(items) {
            const grid = document.getElementById('grid');
            grid.innerHTML = items.map((item, idx) => `
                <div class="movie-card reveal active" style="transition-delay: ${idx * 50}ms" onclick="openDetails('${item.id}', '${item.media_type || 'movie'}')">
                    <div class="relative overflow-hidden rounded-2xl aspect-[2/3] mb-4 bg-zinc-900">
                        <img src="${item.poster_path ? POSTER + item.poster_path : ''}" class="w-full h-full object-cover">
                        <div class="absolute top-3 right-3 bg-black/60 backdrop-blur-md px-2 py-1 rounded-lg text-[10px] font-bold text-yellow-500">
                            <i class="fa fa-star"></i> ${item.vote_average.toFixed(1)}
                        </div>
                    </div>
                    <h4 class="font-bold text-sm truncate uppercase tracking-tighter">${item.title || item.name}</h4>
                    <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">${(item.release_date || item.first_air_date || '2024').split('-')[0]} • ${item.media_type || 'Movie'}</p>
                </div>
            `).join('');
        }

        async function openDetails(id, type) {
            const [details, credits] = await Promise.all([
                fetch(`${TMDB}/${type}/${id}?api_key=${API_KEY}`).then(r => r.json()),
                fetch(`${TMDB}/${type}/${id}/credits?api_key=${API_KEY}`).then(r => r.json())
            ]);

            currentData = { id, type, title: details.title || details.name };
            
            // Populate UI
            document.getElementById('mTitle').innerText = currentData.title;
            document.getElementById('mOverview').innerText = details.overview;
            document.getElementById('mMeta').innerText = `${type} • ${details.genres.map(g => g.name).join(' • ')}`;
            document.getElementById('mRate').innerText = details.vote_average.toFixed(1);
            document.getElementById('mDate').innerText = details.release_date || details.first_air_date;
            
            const director = credits.crew.find(c => c.job === 'Director');
            document.getElementById('mDir').innerText = director ? director.name : 'Unknown';

            // Cast
            document.getElementById('castList').innerHTML = credits.cast.slice(0, 8).map(c => `
                <span class="cast-pill px-4 py-2 rounded-full text-xs font-bold">${c.name}</span>
            `).join('');

            // TV Setup
            const tvSec = document.getElementById('tvSelectors');
            if(type === 'tv') {
                tvSec.classList.remove('hidden');
                document.getElementById('sSelect').innerHTML = details.seasons.map(s => `<option value="${s.season_number}">Season ${s.season_number}</option>`).join('');
                loadEpisodes();
            } else {
                tvSec.classList.add('hidden');
            }

            // Sources
            renderSources();
            document.getElementById('playerModal').classList.replace('hidden', 'flex');
            document.body.style.overflow = 'hidden';
            updatePlayerSource();
            
            saveToHistory(details);
        }

        async function loadEpisodes() {
            const s = document.getElementById('sSelect').value;
            const res = await fetch(`${TMDB}/tv/${currentData.id}/season/${s}?api_key=${API_KEY}`);
            const data = await res.json();
            document.getElementById('eSelect').innerHTML = data.episodes.map(e => `<option value="${e.episode_number}">Episode ${e.episode_number}: ${e.name}</option>`).join('');
            updatePlayerSource();
        }

        function renderSources() {
            const providers = [
                { name: 'Stream-1 (Clean)', color: 'bg-green-600' },
                { name: 'Stream-2 (HD)', color: 'bg-zinc-800' },
                { name: 'Cinema OS', color: 'bg-zinc-800' },
                { name: 'VidSrc Pro', color: 'bg-zinc-800' },
                { name: 'Embed Su', color: 'bg-zinc-800' }
            ];
            document.getElementById('sourceBtns').innerHTML = providers.map((p, idx) => `
                <button onclick="updatePlayerSource(${idx})" class="source-btn ${p.color} p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:scale-105 transition">
                    ${p.name}
                </button>
            `).join('');
        }

        function updatePlayerSource(idx = 0) {
            const s = document.getElementById('sSelect').value || 1;
            const e = document.getElementById('eSelect').value || 1;
            const id = currentData.id;
            
            const urls = [
                currentData.type === 'movie' ? `https://vidsrc.to/embed/movie/${id}` : `https://vidsrc.to/embed/tv/${id}/${s}/${e}`,
                currentData.type === 'movie' ? `https://vidsrc.me/embed/movie?tmdb=${id}` : `https://vidsrc.me/embed/tv?tmdb=${id}&sea=${s}&epi=${e}`,
                currentData.type === 'movie' ? `https://autoembed.to/movie/tmdb/${id}` : `https://autoembed.to/tv/tmdb/${id}-${s}-${e}`,
                currentData.type === 'movie' ? `https://vidsrc.pro/embed/movie/${id}` : `https://vidsrc.pro/embed/tv/${id}/${s}/${e}`,
                currentData.type === 'movie' ? `https://embed.su/embed/movie/${id}` : `https://embed.su/embed/tv/${id}/${s}/${e}`
            ];

            document.getElementById('videoFrame').src = urls[idx];
        }

        function setupSearch() {
            const input = document.getElementById('searchInput');
            input.addEventListener('keypress', async (e) => {
                if(e.key === 'Enter') {
                    const res = await fetch(`${TMDB}/search/multi?api_key=${API_KEY}&query=${input.value}`);
                    const data = await res.json();
                    renderGrid(data.results.filter(i => i.poster_path));
                    document.getElementById('sectionTitle').innerText = `Search: ${input.value}`;
                    window.scrollTo({top: 700, behavior: 'smooth'});
                }
            });
        }

        function closePlayer() {
            document.getElementById('playerModal').classList.replace('flex', 'hidden');
            document.getElementById('videoFrame').src = '';
            document.body.style.overflow = 'auto';
        }

        function toggleSidebar() {
            const side = document.getElementById('sidebar');
            side.classList.toggle('translate-x-full');
            renderSidebar();
        }

        function saveToHistory(item) {
            let hist = JSON.parse(localStorage.getItem('zen_hist') || '[]');
            hist = hist.filter(h => h.id !== item.id).slice(0, 10);
            hist.unshift(item);
            localStorage.setItem('zen_hist', JSON.stringify(hist));
        }

        function renderSidebar() {
            const hist = JSON.parse(localStorage.getItem('zen_hist') || '[]');
            document.getElementById('sidebarContent').innerHTML = hist.map(h => `
                <div class="flex gap-4 items-center bg-white/5 p-3 rounded-xl cursor-pointer" onclick="openDetails('${h.id}', '${h.media_type || 'movie'}')">
                    <img src="${POSTER + h.poster_path}" class="w-12 rounded-lg">
                    <div>
                        <p class="text-xs font-bold truncate w-40">${h.title || h.name}</p>
                        <p class="text-[10px] text-red-500 uppercase">${h.media_type || 'Movie'}</p>
                    </div>
                </div>
            `).join('');
        }

        function playMainHero() { openDetails(hContent.id, hContent.media_type || 'movie'); }
    </script>
</body>
</html>
