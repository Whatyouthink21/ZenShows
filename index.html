<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEN Streams | Free HD Streaming</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
    <link rel="icon" type="image/x-icon" href="https://img.icons8.com/color/96/000000/film-reel.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #0f0f1e;
            color: white;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f0f1e;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid rgba(255,71,87,0.3);
            border-top-color: #ff4757;
            animation: spin 1s infinite linear;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(15,15,30,0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 900;
        }

        .logo i {
            color: #ff4757;
        }

        .logo-highlight {
            color: #ff4757;
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
            position: relative;
        }

        #searchInput {
            width: 100%;
            padding: 10px 15px 10px 40px;
            background: #1a1a2e;
            border: 2px solid #2d2d4d;
            border-radius: 25px;
            color: white;
            font-size: 14px;
        }

        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
        }

        .nav-actions {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 8px 15px;
            background: #1a1a2e;
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .main-content {
            margin-top: 70px;
            padding: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-section {
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
            position: relative;
        }

        .hero-slide {
            height: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            padding: 0 40px;
        }

        .hero-content {
            max-width: 600px;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ff4757, #ff6b81);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .movie-card {
            background: #1a1a2e;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .movie-card:hover {
            transform: translateY(-10px);
        }

        .card-image {
            height: 300px;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-content {
            padding: 15px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-container {
            background: #1a1a2e;
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .sources-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
        }

        .source-btn {
            padding: 20px;
            background: #16213e;
            border: 2px solid #2d2d4d;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .source-btn:hover {
            border-color: #ff4757;
            transform: translateY(-5px);
        }

        .footer {
            background: #16213e;
            padding: 30px 20px;
            margin-top: 50px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 32px;
            }
            
            .sources-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-play-circle"></i>
            <span>ZEN<span class="logo-highlight">STREAMS</span></span>
        </div>
        
        <div class="search-container">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search movies...">
        </div>
        
        <div class="nav-actions">
            <button class="nav-btn" id="watchlistBtn">
                <i class="fas fa-bookmark"></i>
                Watchlist
            </button>
            <button class="nav-btn" id="signInBtn">
                <i class="fas fa-sign-in-alt"></i>
                Sign In
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="swiper hero-swiper">
                <div class="swiper-wrapper" id="heroSlides">
                    <!-- Will be populated by JS -->
                </div>
            </div>
        </section>

        <!-- Movies Grid -->
        <section>
            <h2 style="margin: 20px 0; font-size: 28px;">Popular Movies</h2>
            <div class="movies-grid" id="moviesGrid">
                <!-- Will be populated by JS -->
            </div>
        </section>
    </main>

    <!-- Sources Modal -->
    <div class="modal" id="sourcesModal" style="display: none;">
        <div class="modal-container">
            <div style="padding: 20px; border-bottom: 1px solid #2d2d4d; display: flex; justify-content: space-between;">
                <h3>Choose Streaming Source</h3>
                <button onclick="closeSourcesModal()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sources-grid" id="sourcesGrid">
                <!-- Will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>© 2024 ZEN Streams. Powered by TMDB API.</p>
        <p style="margin-top: 10px; color: #888; font-size: 14px;">
            API Key: a45420333457411e78d5ad35d6c51a2d
        </p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        // ====== FIREBASE CONFIG ======
        const firebaseConfig = {
            apiKey: "AIzaSyCRwom-ZDQy_4AWX-8TknWzii_GVxw33hk",
            authDomain: "zenshows-c4255.firebaseapp.com",
            projectId: "zenshows-c4255",
            storageBucket: "zenshows-c4255.firebasestorage.app",
            messagingSenderId: "824547918366",
            appId: "1:824547918366:web:5b1ae5de7b083a2f77640f",
            measurementId: "G-268SWMN17W"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ====== TMDB CONFIG ======
        const TMDB_API_KEY = 'a45420333457411e78d5ad35d6c51a2d';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p';

        // ====== STREAMING SOURCES ======
        const STREAMING_SOURCES = [
            { id: 1, name: 'VidSrc', url: 'https://vidsrc.me/embed/{type}/{id}' },
            { id: 2, name: 'VidSrc PRO', url: 'https://vidsrc.pro/embed/{type}/{id}' },
            { id: 3, name: '2Embed', url: 'https://www.2embed.cc/embed/{id}' },
            { id: 4, name: 'SuperEmbed', url: 'https://multiembed.mov/direct/tmdb/{type}?id={id}' },
            { id: 5, name: 'SmashyStream', url: 'https://embed.smashystream.com/playere.php?tmdb={id}' },
            { id: 6, name: 'CimaNow', url: 'https://cimanow.cc/embed/tmdb/{type}?id={id}' }
        ];

        // ====== APP STATE ======
        let currentUser = null;
        let userData = { watchlist: [], history: [] };

        // ====== INITIALIZE APP ======
        async function initApp() {
            try {
                // Load movies immediately
                await loadPopularMovies();
                await loadHeroSlides();
                
                // Initialize auth listener
                auth.onAuthStateChanged(async (user) => {
                    currentUser = user;
                    if (user) {
                        await loadUserData(user.uid);
                        updateUI();
                    }
                });
                
                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                    }, 500);
                }, 1000);
                
            } catch (error) {
                console.error('Initialization error:', error);
                // Hide loading screen even on error
                document.getElementById('loadingScreen').style.display = 'none';
            }
        }

        // ====== TMDB FUNCTIONS ======
        async function fetchTMDB(endpoint, params = {}) {
            const url = new URL(`${TMDB_BASE_URL}/${endpoint}`);
            url.searchParams.append('api_key', TMDB_API_KEY);
            url.searchParams.append('language', 'en-US');
            
            Object.keys(params).forEach(key => {
                url.searchParams.append(key, params[key]);
            });
            
            const response = await fetch(url);
            return await response.json();
        }

        async function loadPopularMovies() {
            try {
                const data = await fetchTMDB('movie/popular');
                displayMovies(data.results.slice(0, 12));
            } catch (error) {
                console.error('Error loading movies:', error);
            }
        }

        async function loadHeroSlides() {
            try {
                const data = await fetchTMDB('trending/movie/week');
                const movies = data.results.slice(0, 3);
                
                const heroHTML = movies.map(movie => `
                    <div class="swiper-slide hero-slide" style="background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('${TMDB_IMAGE_BASE}/original${movie.backdrop_path}')">
                        <div class="hero-content">
                            <h1 class="hero-title">${movie.title}</h1>
                            <p style="margin-bottom: 20px; font-size: 18px;">${movie.overview.substring(0, 150)}...</p>
                            <button class="nav-btn" style="background: #ff4757;" onclick="showSources(${movie.id}, 'movie')">
                                <i class="fas fa-play"></i> Watch Now
                            </button>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('heroSlides').innerHTML = heroHTML;
                
                // Initialize Swiper
                new Swiper('.hero-swiper', {
                    autoplay: { delay: 5000 },
                    loop: true
                });
            } catch (error) {
                console.error('Error loading hero slides:', error);
            }
        }

        function displayMovies(movies) {
            const moviesHTML = movies.map(movie => `
                <div class="movie-card">
                    <div class="card-image">
                        <img src="${TMDB_IMAGE_BASE}/w342${movie.poster_path}" 
                             alt="${movie.title}"
                             onerror="this.src='https://via.placeholder.com/342x513?text=No+Image'">
                    </div>
                    <div class="card-content">
                        <h3 style="margin-bottom: 10px; font-size: 16px;">${movie.title}</h3>
                        <div style="display: flex; justify-content: space-between; color: #888; font-size: 14px;">
                            <span>★ ${movie.vote_average.toFixed(1)}</span>
                            <span>${movie.release_date.split('-')[0]}</span>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button onclick="showSources(${movie.id}, 'movie')" 
                                    style="flex: 1; padding: 8px; background: #ff4757; border: none; border-radius: 5px; color: white; cursor: pointer;">
                                <i class="fas fa-play"></i> Watch
                            </button>
                            <button onclick="toggleWatchlist(${movie.id}, 'movie', '${movie.title.replace(/'/g, "\\'")}', '${movie.poster_path}')" 
                                    style="padding: 8px; background: #2d2d4d; border: none; border-radius: 5px; color: white; cursor: pointer;">
                                <i class="fas fa-bookmark"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('moviesGrid').innerHTML = moviesHTML;
        }

        // ====== STREAMING SOURCES ======
        function showSources(id, type) {
            const sourcesHTML = STREAMING_SOURCES.map(source => `
                <div class="source-btn" onclick="openStream('${source.url.replace('{type}', type).replace('{id}', id)}')">
                    <i class="fas fa-play-circle" style="font-size: 30px; margin-bottom: 10px;"></i>
                    <div>${source.name}</div>
                </div>
            `).join('');
            
            document.getElementById('sourcesGrid').innerHTML = sourcesHTML;
            document.getElementById('sourcesModal').style.display = 'flex';
            
            // Add to history
            addToHistory(id, type);
        }

        function openStream(url) {
            window.open(url, '_blank');
            closeSourcesModal();
        }

        function closeSourcesModal() {
            document.getElementById('sourcesModal').style.display = 'none';
        }

        // ====== FIREBASE FUNCTIONS ======
        async function loadUserData(uid) {
            try {
                const doc = await db.collection('users').doc(uid).get();
                if (doc.exists) {
                    userData = doc.data();
                } else {
                    await db.collection('users').doc(uid).set({
                        watchlist: [],
                        history: [],
                        createdAt: new Date().toISOString()
                    });
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function addToHistory(id, type) {
            if (!currentUser) return;
            
            try {
                const historyItem = {
                    id,
                    type,
                    timestamp: new Date().toISOString()
                };
                
                await db.collection('users').doc(currentUser.uid).update({
                    history: firebase.firestore.FieldValue.arrayUnion(historyItem)
                });
                
                userData.history.push(historyItem);
            } catch (error) {
                console.error('Error adding to history:', error);
            }
        }

        async function toggleWatchlist(id, type, title, posterPath) {
            if (!currentUser) {
                alert('Please sign in to use watchlist');
                return;
            }
            
            try {
                const watchlistItem = {
                    id,
                    type,
                    title,
                    posterPath,
                    addedAt: new Date().toISOString()
                };
                
                const existingIndex = userData.watchlist.findIndex(item => item.id === id);
                
                if (existingIndex > -1) {
                    // Remove from watchlist
                    userData.watchlist.splice(existingIndex, 1);
                    await db.collection('users').doc(currentUser.uid).update({
                        watchlist: firebase.firestore.FieldValue.arrayRemove(watchlistItem)
                    });
                    alert('Removed from watchlist');
                } else {
                    // Add to watchlist
                    userData.watchlist.push(watchlistItem);
                    await db.collection('users').doc(currentUser.uid).update({
                        watchlist: firebase.firestore.FieldValue.arrayUnion(watchlistItem)
                    });
                    alert('Added to watchlist!');
                }
                
                updateUI();
            } catch (error) {
                console.error('Error updating watchlist:', error);
            }
        }

        async function signIn() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
            } catch (error) {
                console.error('Sign in error:', error);
            }
        }

        function signOut() {
            auth.signOut();
        }

        function updateUI() {
            const signInBtn = document.getElementById('signInBtn');
            const watchlistBtn = document.getElementById('watchlistBtn');
            
            if (currentUser) {
                signInBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Sign Out';
                signInBtn.onclick = signOut;
                watchlistBtn.innerHTML = `<i class="fas fa-bookmark"></i> Watchlist (${userData.watchlist.length})`;
            } else {
                signInBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
                signInBtn.onclick = signIn;
                watchlistBtn.innerHTML = '<i class="fas fa-bookmark"></i> Watchlist';
            }
        }

        // ====== SEARCH FUNCTION ======
        document.getElementById('searchInput').addEventListener('input', async function(e) {
            const query = e.target.value.trim();
            if (query.length < 2) return;
            
            try {
                const data = await fetchTMDB('search/movie', { query });
                displayMovies(data.results);
            } catch (error) {
                console.error('Search error:', error);
            }
        });

        // ====== INITIALIZE ======
        document.addEventListener('DOMContentLoaded', initApp);

        // Close modal on outside click
        document.getElementById('sourcesModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSourcesModal();
            }
        });
    </script>
</body>
</html>
